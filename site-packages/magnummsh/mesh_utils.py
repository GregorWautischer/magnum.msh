#!/usr/bin/python

# Copyright (C) 2011-2015 Florian Bruckner
#
# This file is part of magnum.msh.
#
# magnum.msh is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# magnum.msh is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with magnum.msh. If not, see <http://www.gnu.org/licenses/>.
#
# Last modified by Florian Bruckner, 2015-10-14

from dolfin import *
import numpy as np

class MeshTool(object):
  def __init__(self):
    self._mesh = Mesh()
    pass

  def add(self, newmesh, domain_id=None):
    """
    Add (non-overlapping) mesh

    *Arguments*
      mesh (:class:`Mesh`)
      domain (:class:`int`)
        domain id if not included in mesh
    """
    editor = MeshEditor()
    origmesh = self._mesh
    mesh = Mesh()
    N = origmesh.num_vertices()
    NE = origmesh.num_cells()
    editor.open(mesh, 3, 3)
    editor.init_vertices(N+newmesh.num_vertices())
    editor.init_cells(NE+newmesh.num_cells())

    if N != 0:
      map(lambda n, x: editor.add_vertex(n, x), np.arange(N), origmesh.coordinates())
      map(lambda n, c: editor.add_cell(n, np.array(c, dtype=np.uintp)), np.arange(NE), origmesh.cells())

    map(lambda n, x: editor.add_vertex(N+n, x), np.arange(newmesh.num_vertices()), newmesh.coordinates())
    map(lambda n, c: editor.add_cell(NE+n, np.array(c+N, dtype=np.uintp)), np.arange(newmesh.num_cells()), newmesh.cells())
    editor.close()
    self._mesh = mesh

  def scale(self, s):
    """
    Scale mesh by given scalar or vector

    *Arguments*
      scaling factor (:class:`float` or :class:`tuple`)
    """
    self.coordinates()[:,:]*np.array(s)

  def mesh(self):
    return self._mesh
